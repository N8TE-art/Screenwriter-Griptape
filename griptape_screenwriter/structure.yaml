version: "1.0"
runtime: python3
runtime_version: "3.11"

structure:
  id: screenwriter_pipeline
  description: >
    A Griptape structure that chains four agents (Plot Architect, Character Designer,
    Thematic Analyst, Scene Shaper) using Robert McKeeâ€™s story principles and a shared StoryContext.

  inputs:
    - name: premise
      description: "Story premise (logline)"
      required: true
      type: string

  tasks:
    - id: plot_architect
      type: prompt
      input_template: |
        {{ args[0] }}
      driver:
        type: openai-chat
        config:
          model: gpt-4
          temperature: 0.3
      output_schema: StoryContext

    - id: character_designer
      type: prompt
      input_template: |
        {{ tasks.plot_architect.output | to_json }}
      driver:
        type: openai-chat
        config:
          model: gpt-4
          temperature: 0.3
      output_schema: StoryContext

    - id: thematic_analyst
      type: prompt
      input_template: |
        {
          "outline": {{ tasks.plot_architect.output | to_json }},
          "characters": {{ tasks.character_designer.output.characters | to_json }}
        }
      driver:
        type: openai-chat
        config:
          model: gpt-4
          temperature: 0
      output_schema: StoryContext

    - id: scene_shaper
      type: prompt
      input_template: |
        {
          "premise": {{ args[0] | to_json }},
          "outline": {{ tasks.plot_architect.output | to_json }},
          "characters": {{ tasks.character_designer.output.characters | to_json }},
          "notes": {{ tasks.thematic_analyst.output.notes | to_json }}
        }
      driver:
        type: openai-chat
        config:
          model: gpt-4
          temperature: 0.7
      output_schema: StoryContext

  output_task: scene_shaper

run:
  main_file: structure.py
  entrypoint: structure:build_workflow
